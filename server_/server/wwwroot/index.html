<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NET_WATCH // SERVER_ADMIN</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>
    
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-cyber-grid scanlines text-gray-300 font-mono overflow-hidden h-screen flex flex-col">

    <header class="bg-black/90 border-b border-[#FCEE0A]/30 p-4 shrink-0 z-20">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="p-2 border border-[#FCEE0A] bg-black">
                    <i data-lucide="server" class="w-6 h-6 text-[#FCEE0A] animate-pulse"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-display font-black text-white tracking-tighter leading-none">
                        NET_<span class="text-[#FCEE0A]">WATCH</span>
                    </h1>
                    <div class="flex items-center gap-2 text-[10px] text-[#00F0FF] tracking-widest mt-1">
                        <span class="w-2 h-2 bg-[#00F0FF] rounded-full animate-pulse"></span>
                        <span>SERVER_MAINFRAME // ONLINE</span>
                    </div>
                </div>
            </div>

            <div class="flex items-center gap-6 font-mono text-xs">
                <div class="text-right">
                    <p class="text-gray-500">HOST_ADDRESS</p>
                    <p class="text-[#FCEE0A] text-lg" id="server-ip">127.0.0.1</p>
                </div>
                <div class="text-right">
                    <p class="text-gray-500">UPTIME</p>
                    <p class="text-[#00F0FF] text-lg" id="uptime-counter">00:00:00</p>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-1 container mx-auto p-6 overflow-hidden flex flex-col gap-6 relative z-10">
        
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 h-1/3">
            
            <div class="lg:col-span-8 cyber-card flex flex-col justify-center">
                <div class="absolute top-0 right-0 p-2 opacity-50">
                    <i data-lucide="cpu" class="w-16 h-16 text-[#FCEE0A]/20"></i>
                </div>
                
                <div class="grid grid-cols-2 gap-8 relative z-10">
                    <div>
                        <div class="flex justify-between text-[#FCEE0A] mb-2 font-display tracking-wider">
                            <span>CPU_LOAD</span>
                            <span id="cpu-val" class="font-bold">0%</span>
                        </div>
                        <div class="h-4 bg-[#111] border border-gray-800 relative overflow-hidden">
                            <div id="cpu-bar" class="h-full bg-[#FCEE0A] transition-all duration-300" style="width: 0%"></div>
                            <div class="absolute inset-0 bg-[linear-gradient(90deg,transparent_90%,#000_90%)] bg-[length:10%_100%] opacity-50"></div>
                        </div>
                    </div>

                    <div>
                        <div class="flex justify-between text-[#00F0FF] mb-2 font-display tracking-wider">
                            <span>MEMORY_ALLOC</span>
                            <span id="ram-val" class="font-bold">0%</span>
                        </div>
                        <div class="h-4 bg-[#111] border border-gray-800 relative overflow-hidden">
                            <div id="ram-bar" class="h-full bg-[#00F0FF] transition-all duration-300" style="width: 0%"></div>
                            <div class="absolute inset-0 bg-[linear-gradient(90deg,transparent_90%,#000_90%)] bg-[length:10%_100%] opacity-50"></div>
                        </div>
                    </div>
                </div>
                <div class="mt-4 text-xs text-gray-500 font-mono text-center">
                    SYSTEM RESOURCES MONITORING ACTIVE
                </div>
            </div>

            <div class="lg:col-span-4 cyber-card flex flex-col justify-between">
                <h3 class="text-white font-display text-lg border-b border-gray-700 pb-2 mb-2">
                    > GLOBAL_ACTIONS
                </h3>
                
                <div class="flex flex-col gap-3">
                    <button id="lock-all-btn" class="cyber-btn w-full text-xs flex items-center justify-center gap-2">
                        <i data-lucide="lock"></i> LOCK ALL CLIENTS
                    </button>
                    
                    <button id="kill-switch-btn" class="cyber-btn bg-transparent border border-[#FF003C] text-[#FF003C] hover:bg-[#FF003C] hover:text-black w-full text-xs flex items-center justify-center gap-2">
                        <i data-lucide="skull"></i> EMERGENCY KILL SWITCH
                    </button>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 flex-1 min-h-0">
            
            <div class="cyber-card flex flex-col h-full min-h-0">
                <div class="flex justify-between items-center mb-4 border-b border-gray-800 pb-2">
                    <h3 class="text-[#FCEE0A] font-display">SYSTEM_LOGS</h3>
                    <button onclick="clearLogs()" class="text-xs text-gray-500 hover:text-white">[CLEAR]</button>
                </div>
                <div id="log-container" class="flex-1 overflow-y-auto font-mono text-xs space-y-1 p-2 bg-black/50 border border-gray-800">
                    <div class="text-gray-500">Initializing NetWatch Protocol v2.77...</div>
                    <div class="text-[#00F0FF]">Listening for incoming connections...</div>
                </div>
            </div>

            <div class="cyber-card flex flex-col h-full min-h-0">
                <div class="flex justify-between items-center mb-4 border-b border-gray-800 pb-2">
                    <h3 class="text-[#00F0FF] font-display">ACTIVE_NODES</h3>
                    <span id="client-count" class="bg-[#00F0FF]/10 text-[#00F0FF] px-2 py-1 text-xs">0 DETECTED</span>
                </div>
                
                <div class="flex-1 overflow-y-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="text-gray-500 text-xs uppercase bg-black/50 sticky top-0">
                            <tr>
                                <th class="px-4 py-2">ID</th>
                                <th class="px-4 py-2">NAME</th>
                                <th class="px-4 py-2 text-right">STATUS</th>
                            </tr>
                        </thead>
                        <tbody id="clients-tbody" class="divide-y divide-gray-800">
                            <tr>
                                <td colspan="3" class="px-4 py-8 text-center text-gray-600 italic">
                                    Scanning network for signals...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-black border-t border-gray-800 p-2 text-center text-[10px] text-gray-600 font-mono">
        SECURE CONNECTION ENCRYPTED // NET_WATCH CORP © 2077
    </footer>

    <script>
        // Init Lucide Icons
        lucide.createIcons();

        // Update Uptime
        let seconds = 0;
        setInterval(() => {
            seconds++;
            const date = new Date(0);
            date.setSeconds(seconds);
            document.getElementById('uptime-counter').innerText = date.toISOString().substr(11, 8);
        }, 1000);

        // SignalR Connection
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/systemHub")
            .withAutomaticReconnect()
            .build();

        // 1. Receive Log
        connection.on("ReceiveLog", (message) => {
            const container = document.getElementById("log-container");
            const div = document.createElement("div");
            const time = new Date().toLocaleTimeString();
            
            // Color coding for logs
            let colorClass = "text-gray-300";
            if (message.includes("Error") || message.includes("Disconnected")) colorClass = "text-[#FF003C]";
            else if (message.includes("Connected")) colorClass = "text-[#00F0FF]";
            else if (message.includes("Command")) colorClass = "text-[#FCEE0A]";

            div.innerHTML = `<span class="text-gray-600">[${time}]</span> <span class="${colorClass}">${message}</span>`;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight; // Auto scroll
        });

        // 2. Update Client List
        connection.on("UpdateClientList", (clients) => {
            document.getElementById("client-count").innerText = `${clients.length} DETECTED`;
            const tbody = document.getElementById("clients-tbody");
            tbody.innerHTML = "";

            if (clients.length === 0) {
                tbody.innerHTML = `<tr><td colspan="3" class="px-4 py-8 text-center text-gray-600 italic">No active signals...</td></tr>`;
                return;
            }

            clients.forEach(client => {
                const tr = document.createElement("tr");
                tr.className = "hover:bg-[#FCEE0A]/10 transition-colors cursor-default";
                tr.innerHTML = `
                    <td class="px-4 py-2 font-mono text-[#FCEE0A]">${client.id.substring(0,8)}...</td>
                    <td class="px-4 py-2 text-white flex items-center gap-2">
                        <i data-lucide="monitor" class="w-4 h-4 text-gray-500"></i> ${client.name}
                    </td>
                    <td class="px-4 py-2 text-right">
                        <span class="inline-block w-2 h-2 rounded-full bg-[#00F0FF] animate-pulse"></span>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            lucide.createIcons();
        });

        // 3. Receive Stats
        connection.on("ReceiveSystemStats", (stats) => {
            // Update CPU
            document.getElementById("cpu-val").innerText = stats.cpu + "%";
            document.getElementById("cpu-bar").style.width = stats.cpu + "%";
            
            // Update RAM
            const ramPercent = Math.round((stats.ramUsed / stats.ramTotal) * 100);
            document.getElementById("ram-val").innerText = ramPercent + "%";
            document.getElementById("ram-bar").style.width = ramPercent + "%";
        });

        // Start Connection
        async function start() {
            try {
                await connection.start();
                console.log("SignalR Connected.");
                document.getElementById('server-ip').innerText = window.location.hostname;
                // Ask for initial state
                await connection.invoke("GetAgents"); 
            } catch (err) {
                console.error(err);
                setTimeout(start, 5000);
            }
        }

        // Button Actions
        document.getElementById('lock-all-btn').addEventListener('click', async () => {
            if(confirm("EXECUTE PROTOCOL: LOCK ALL STATIONS?")) {
                await connection.invoke("BroadcastCommand", "lock");
            }
        });

        document.getElementById('kill-switch-btn').addEventListener('click', async () => {
            if(confirm("⚠ WARNING: EMERGENCY SHUTDOWN ALL CLIENTS?")) {
                await connection.invoke("BroadcastCommand", "shutdown");
            }
        });

        function clearLogs() {
            document.getElementById("log-container").innerHTML = "";
        }

        start();
    </script>
</body>
</html>